

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Lotka-Volterra Dataset Exploration &amp; LLMTIME Preprocessing &mdash; Time Series Forecasting with LLMs beta documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/sg_gallery.css?v=d2d258e8" />
      <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css?v=2aa19091" />
      <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=a6e103b4" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=f0d2c090"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
      <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
      <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Understanding FLOPS Calculation for Qwen2.5 Models" href="2_flops_calculation.html" />
    <link rel="prev" title="Time Series Forecasting with Qwen2.5-0.5B LLM" href="../index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Time Series Forecasting with LLMs
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Jupyter Notebooks</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Lotka-Volterra Dataset Exploration &amp; LLMTIME Preprocessing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Dataset-Overview">Dataset Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Interactive-Visualization-of-Predator-Prey-Dynamics">Interactive Visualization of Predator-Prey Dynamics</a></li>
<li class="toctree-l2"><a class="reference internal" href="#LLMTIME-Preprocessing-Scheme-Implementation">LLMTIME Preprocessing Scheme Implementation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Scaling-and-Formatting">Scaling and Formatting</a></li>
<li class="toctree-l3"><a class="reference internal" href="#LLMTIME-String-Representation">LLMTIME String Representation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Tokenization-with-Qwen2.5-Tokenizer">Tokenization with Qwen2.5 Tokenizer</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Complete-Preprocessing-Pipeline-with-NumericalProcessor">Complete Preprocessing Pipeline with NumericalProcessor</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Round-Trip-Testing:-Tokenize-→-Detokenize">Round-Trip Testing: Tokenize → Detokenize</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Conclusion">Conclusion</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Appendix:-Additional-Samples">Appendix: Additional Samples</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="2_flops_calculation.html">Understanding FLOPS Calculation for Qwen2.5 Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="3_untrained_behaviour.html">Evaluating Untrained LLM Performance on Time Series Forecasting</a></li>
<li class="toctree-l1"><a class="reference internal" href="4_train_lora_llm.html">Train LoRA-LLM</a></li>
<li class="toctree-l1"><a class="reference internal" href="5_initial_train_behaviour.html">Evaluating Trained LLM Performance on Time Series Forecasting</a></li>
<li class="toctree-l1"><a class="reference internal" href="6_fully_trained_behaviour.html">Evaluating Fully Trained LLM Performance on Time Series Forecasting</a></li>
<li class="toctree-l1"><a class="reference internal" href="6_fully_trained_behaviour.html#Flops-Analysis">Flops Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="7_weight_visualize.html">LM Bias Weight Visualization</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Time Series Forecasting with LLMs</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Lotka-Volterra Dataset Exploration &amp; LLMTIME Preprocessing</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/notebooks/1_dataset_preprocess.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="admonition note">
<p class="admonition-title">Note</p>
<p>This page was generated from a Jupyter notebook.
<a class="reference external" href="https://github.com/yourusername/time_series_llm/blob/main/notebooks1_dataset_preprocess.ipynb">View the original notebook</a></p>
</div>
<section id="Lotka-Volterra-Dataset-Exploration-&amp;-LLMTIME-Preprocessing">
<h1>Lotka-Volterra Dataset Exploration &amp; LLMTIME Preprocessing<a class="headerlink" href="#Lotka-Volterra-Dataset-Exploration-&-LLMTIME-Preprocessing" title="Link to this heading"></a></h1>
<p>This notebook explores the predator-prey dataset and implements the LLMTIME preprocessing scheme for use with the Qwen2.5-0.5B-Instruct model. We’ll demonstrate:</p>
<ol class="arabic simple">
<li><p>Dataset characteristics and visualization</p></li>
<li><p>Implementation of the LLMTIME preprocessing scheme</p></li>
<li><p>Tokenization and detokenization of predator-prey time series</p></li>
<li><p>Analysis of information preservation through the tokenization process</p></li>
</ol>
<section id="Dataset-Overview">
<h2>Dataset Overview<a class="headerlink" href="#Dataset-Overview" title="Link to this heading"></a></h2>
<p>The dataset consists of 1000 different predator-prey systems, each with 100 time points and 2 variables (prey and predator populations). These systems follow Lotka-Volterra dynamics, which model cyclical population changes in ecological systems.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">h5py</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">transformers</span><span class="w"> </span><span class="kn">import</span> <span class="n">AutoTokenizer</span>

<span class="c1"># data folder:</span>
<span class="n">DATA_FOLDER</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__name__</span><span class="p">),</span> <span class="s1">&#39;..&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">)</span>

<span class="c1"># Load dataset</span>
<span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">DATA_FOLDER</span><span class="p">,</span> <span class="s1">&#39;lotka_volterra_data.h5&#39;</span><span class="p">),</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">trajectories</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s2">&quot;trajectories&quot;</span><span class="p">][:]</span>  <span class="c1"># Shape: (1000, 100, 2)</span>
    <span class="n">time_points</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">][:]</span>           <span class="c1"># Shape: (100,)</span>

<span class="c1"># Print basic statistics</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Dataset shape: </span><span class="si">{</span><span class="n">trajectories</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2"> - (num_systems, time_points, variables)&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Time range: </span><span class="si">{</span><span class="n">time_points</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">time_points</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Prey population - Mean: </span><span class="si">{</span><span class="n">trajectories</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">, Range: [</span><span class="si">{</span><span class="n">trajectories</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">trajectories</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Predator population - Mean: </span><span class="si">{</span><span class="n">trajectories</span><span class="p">[:,:,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">, Range: [</span><span class="si">{</span><span class="n">trajectories</span><span class="p">[:,:,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">trajectories</span><span class="p">[:,:,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span>

<span class="c1"># Plot distribution of prey and predator populations</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">trajectories</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Prey Population Distribution&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Population Size&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Frequency&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">trajectories</span><span class="p">[:,:,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Predator Population Distribution&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Population Size&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Dataset shape: (1000, 100, 2) - (num_systems, time_points, variables)
Time range: 0.00 to 200.00
Prey population - Mean: 1.6981, Range: [0.0021, 13.7401]
Predator population - Mean: 0.5696, Range: [0.0000, 4.7685]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_1_dataset_preprocess_1_1.png" src="../_images/notebooks_1_dataset_preprocess_1_1.png" />
</div>
</div>
<p>The distributions above show us the range of values for both prey and predator populations. Understanding these distributions helps us design appropriate scaling factors for the LLMTIME preprocessing.</p>
</section>
<section id="Interactive-Visualization-of-Predator-Prey-Dynamics">
<h2>Interactive Visualization of Predator-Prey Dynamics<a class="headerlink" href="#Interactive-Visualization-of-Predator-Prey-Dynamics" title="Link to this heading"></a></h2>
<p>Below, we provide an interactive tool to explore different predator-prey systems. This helps us understand the temporal dynamics and cyclical behavior characteristic of Lotka-Volterra systems.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">ipywidgets</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">widgets</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">IPython.display</span><span class="w"> </span><span class="kn">import</span> <span class="n">display</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">mpl</span>

<span class="k">def</span><span class="w"> </span><span class="nf">plot_trajectory</span><span class="p">(</span><span class="n">trajectory_id</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">time_range</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> <span class="n">plot_type</span><span class="o">=</span><span class="s1">&#39;time_series&#39;</span><span class="p">,</span> <span class="n">show_grid</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="c1"># Define beautiful colors with transparency</span>
    <span class="n">prey_color</span> <span class="o">=</span> <span class="s1">&#39;rgba(102, 204, 255, 0.8)&#39;</span>  <span class="c1"># Light blue</span>
    <span class="n">predator_color</span> <span class="o">=</span> <span class="s1">&#39;rgba(255, 153, 153, 0.8)&#39;</span>  <span class="c1"># Light red/pink</span>

    <span class="c1"># Convert rgba to matplotlib format</span>
    <span class="n">prey_rgba</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">prey_color</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;rgba()&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)[</span><span class="n">i</span><span class="p">])</span> <span class="o">/</span> <span class="mi">255</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span> <span class="o">+</span> <span class="p">(</span><span class="mf">0.8</span><span class="p">,)</span>
    <span class="n">predator_rgba</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">predator_color</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;rgba()&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)[</span><span class="n">i</span><span class="p">])</span> <span class="o">/</span> <span class="mi">255</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span> <span class="o">+</span> <span class="p">(</span><span class="mf">0.8</span><span class="p">,)</span>

    <span class="c1"># Set figure style</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;seaborn-v0_8-whitegrid&#39;</span><span class="p">)</span>

    <span class="c1"># Get selected time points and data</span>
    <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">time_range</span>
    <span class="n">selected_times</span> <span class="o">=</span> <span class="n">time_points</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span>
    <span class="n">prey_data</span> <span class="o">=</span> <span class="n">trajectories</span><span class="p">[</span><span class="n">trajectory_id</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">predator_data</span> <span class="o">=</span> <span class="n">trajectories</span><span class="p">[</span><span class="n">trajectory_id</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">plot_type</span> <span class="o">==</span> <span class="s1">&#39;time_series&#39;</span><span class="p">:</span>
        <span class="c1"># Plot prey and predator over time with enhanced styling</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">selected_times</span><span class="p">,</span> <span class="n">prey_data</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Prey&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">prey_rgba</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">selected_times</span><span class="p">,</span> <span class="n">predator_data</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Predator&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">predator_rgba</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

        <span class="c1"># # Add light fill below curves for visual appeal</span>
        <span class="c1"># plt.fill_between(selected_times, 0, prey_data, color=prey_rgba, alpha=0.3)</span>
        <span class="c1"># plt.fill_between(selected_times, 0, predator_data, color=predator_rgba, alpha=0.3)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Time&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Population&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">plot_type</span> <span class="o">==</span> <span class="s1">&#39;phase_space&#39;</span><span class="p">:</span>
        <span class="c1"># Enhanced phase space plot</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">prey_data</span><span class="p">,</span> <span class="n">predator_data</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;purple&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>

        <span class="c1"># Add direction arrows to show trajectory progression</span>
        <span class="n">arrow_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">prey_data</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">prey_data</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">arrow_indices</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">arrow</span><span class="p">(</span><span class="n">prey_data</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">predator_data</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                     <span class="p">(</span><span class="n">prey_data</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">prey_data</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">*</span><span class="mf">0.8</span><span class="p">,</span>
                     <span class="p">(</span><span class="n">predator_data</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">predator_data</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">*</span><span class="mf">0.8</span><span class="p">,</span>
                     <span class="n">head_width</span><span class="o">=</span><span class="mf">0.03</span><span class="p">,</span> <span class="n">head_length</span><span class="o">=</span><span class="mf">0.03</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;purple&#39;</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="s1">&#39;purple&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>

        <span class="c1"># Highlight start and end points</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">prey_data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">predator_data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">prey_rgba</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span>
                   <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Start&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">prey_data</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">predator_data</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">predator_rgba</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span>
                   <span class="n">label</span><span class="o">=</span><span class="s1">&#39;End&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Prey Population&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Predator Population&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>

    <span class="c1"># Enhance overall plot appearance</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Lotka-Volterra System </span><span class="si">{</span><span class="n">trajectory_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">show_grid</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

    <span class="c1"># Create a fancy legend</span>
    <span class="n">legend</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">frameon</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>
    <span class="n">frame</span> <span class="o">=</span> <span class="n">legend</span><span class="o">.</span><span class="n">get_frame</span><span class="p">()</span>
    <span class="n">frame</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>
    <span class="n">frame</span><span class="o">.</span><span class="n">set_alpha</span><span class="p">(</span><span class="mf">0.9</span><span class="p">)</span>
    <span class="n">frame</span><span class="o">.</span><span class="n">set_edgecolor</span><span class="p">(</span><span class="s1">&#39;lightgray&#39;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Create interactive widgets</span>
<span class="n">trajectory_slider</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">IntSlider</span><span class="p">(</span>
    <span class="n">value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">trajectories</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s1">&#39;System ID:&#39;</span><span class="p">,</span> <span class="n">continuous_update</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>

<span class="n">time_range_slider</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">IntRangeSlider</span><span class="p">(</span>
    <span class="n">value</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">time_points</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Time Range:&#39;</span><span class="p">,</span> <span class="n">continuous_update</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>

<span class="n">plot_type_dropdown</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Dropdown</span><span class="p">(</span>
    <span class="n">options</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;Time Series&#39;</span><span class="p">,</span> <span class="s1">&#39;time_series&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;Phase Space&#39;</span><span class="p">,</span> <span class="s1">&#39;phase_space&#39;</span><span class="p">)],</span>
    <span class="n">value</span><span class="o">=</span><span class="s1">&#39;time_series&#39;</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Plot Type:&#39;</span>
<span class="p">)</span>

<span class="n">grid_checkbox</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Checkbox</span><span class="p">(</span>
    <span class="n">value</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Show Grid&#39;</span>
<span class="p">)</span>

<span class="c1"># Create interactive output</span>
<span class="n">interactive_plot</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">interactive</span><span class="p">(</span>
    <span class="n">plot_trajectory</span><span class="p">,</span>
    <span class="n">trajectory_id</span><span class="o">=</span><span class="n">trajectory_slider</span><span class="p">,</span>
    <span class="n">time_range</span><span class="o">=</span><span class="n">time_range_slider</span><span class="p">,</span>
    <span class="n">plot_type</span><span class="o">=</span><span class="n">plot_type_dropdown</span><span class="p">,</span>
    <span class="n">show_grid</span><span class="o">=</span><span class="n">grid_checkbox</span>
<span class="p">)</span>

<span class="n">display</span><span class="p">(</span><span class="n">interactive_plot</span><span class="p">)</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "fac64e4e575d484b85dae2c766d1ba45", "version_major": 2, "version_minor": 0}</script></div>
</div>
</section>
<section id="LLMTIME-Preprocessing-Scheme-Implementation">
<h2>LLMTIME Preprocessing Scheme Implementation<a class="headerlink" href="#LLMTIME-Preprocessing-Scheme-Implementation" title="Link to this heading"></a></h2>
<p>According to the LLMTIME paper and coursework requirements, we need to:</p>
<ol class="arabic simple">
<li><p><strong>Scale</strong> the numerical values to a reasonable range (e.g., mostly within 0-10)</p></li>
<li><p><strong>Format</strong> the values with fixed precision (e.g., 2 decimal places)</p></li>
<li><p><strong>Encode</strong> multivariate time series using:</p>
<ul class="simple">
<li><p>Commas (<code class="docutils literal notranslate"><span class="pre">,</span></code>) to separate different variables at the same timestep</p></li>
<li><p>Semicolons (<code class="docutils literal notranslate"><span class="pre">;</span></code>) to separate different timesteps</p></li>
</ul>
</li>
</ol>
<p>Let’s examine a sample of raw data first:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Extract a sample from the first trajectory</span>
<span class="n">sample_idx</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">prey</span> <span class="o">=</span> <span class="n">trajectories</span><span class="p">[</span><span class="n">sample_idx</span><span class="p">,</span> <span class="p">:</span><span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>  <span class="c1"># First 10 time points of prey</span>
<span class="n">predator</span> <span class="o">=</span> <span class="n">trajectories</span><span class="p">[</span><span class="n">sample_idx</span><span class="p">,</span> <span class="p">:</span><span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>  <span class="c1"># First 10 time points of predator</span>

<span class="c1"># Display the raw data</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Sample prey data:     </span><span class="si">{</span><span class="n">prey</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Sample predator data: </span><span class="si">{</span><span class="n">predator</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Interleave prey and predator values to visualize structure</span>
<span class="n">interleaved</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">prey</span><span class="p">,</span> <span class="n">predator</span><span class="p">))</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Interleaved data: </span><span class="si">{</span><span class="n">interleaved</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Sample prey data:     [0.94991744 0.74055135 0.6822457  0.7166742  0.82451135 1.0045652
 1.2629277  1.6055092  2.0311053  2.5228817 ]
Sample predator data: [1.040624   0.7795419  0.56439036 0.40764433 0.30028325 0.22983165
 0.18616238 0.16223547 0.15436463 0.16188619]

Interleaved data: [0.94991744 1.040624   0.74055135 0.7795419  0.6822457  0.56439036
 0.7166742  0.40764433 0.82451135 0.30028325 1.0045652  0.22983165
 1.2629277  0.18616238 1.6055092  0.16223547 2.0311053  0.15436463
 2.5228817  0.16188619]
</pre></div></div>
</div>
<section id="Scaling-and-Formatting">
<h3>Scaling and Formatting<a class="headerlink" href="#Scaling-and-Formatting" title="Link to this heading"></a></h3>
<p>Following the LLMTIME approach, we’ll scale the values to keep them mostly within 0-10. Using the 99.7 percentile (approximately 3 standard deviations) ensures outliers don’t overly influence the scaling.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculate scaling factor based on 99.7 percentile</span>
<span class="n">max_magnitude</span> <span class="o">=</span> <span class="mf">10.0</span>
<span class="n">all_values</span> <span class="o">=</span> <span class="n">trajectories</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">scaling_factor</span> <span class="o">=</span> <span class="n">max_magnitude</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">all_values</span><span class="p">,</span> <span class="mf">99.7</span><span class="p">)</span>

<span class="c1"># Apply scaling</span>
<span class="n">scaled_prey</span> <span class="o">=</span> <span class="n">prey</span> <span class="o">*</span> <span class="n">scaling_factor</span>
<span class="n">scaled_predator</span> <span class="o">=</span> <span class="n">predator</span> <span class="o">*</span> <span class="n">scaling_factor</span>

<span class="c1"># Apply precision formatting (2 decimal places)</span>
<span class="n">precision</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">formatted_prey</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">scaled_prey</span><span class="p">,</span> <span class="n">precision</span><span class="p">)</span>
<span class="n">formatted_predator</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">scaled_predator</span><span class="p">,</span> <span class="n">precision</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">Scaling factor: </span><span class="si">{</span><span class="n">scaling_factor</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span>
<span class="s2">Original prey: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">x</span><span class="si">:</span><span class="s1">.6f</span><span class="si">}</span><span class="s1">&#39;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">prey</span><span class="p">)</span><span class="si">}</span>
<span class="s2">Scaled prey: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">x</span><span class="si">:</span><span class="s1">.6f</span><span class="si">}</span><span class="s1">&#39;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">scaled_prey</span><span class="p">)</span><span class="si">}</span>
<span class="s2">Formatted prey: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">x</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">&#39;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">formatted_prey</span><span class="p">)</span><span class="si">}</span>
<span class="s2">Original predator: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">x</span><span class="si">:</span><span class="s1">.6f</span><span class="si">}</span><span class="s1">&#39;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">predator</span><span class="p">)</span><span class="si">}</span>
<span class="s2">Scaled predator: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">x</span><span class="si">:</span><span class="s1">.6f</span><span class="si">}</span><span class="s1">&#39;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">scaled_predator</span><span class="p">)</span><span class="si">}</span>
<span class="s2">Formatted predator: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">x</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">&#39;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">formatted_predator</span><span class="p">)</span><span class="si">}</span>
<span class="s2">    &quot;&quot;&quot;</span>
<span class="p">)</span>


<span class="c1"># Display results</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Scaling factor: </span><span class="si">{</span><span class="n">scaling_factor</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Original vs. Scaled &amp; Formatted:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">prey</span><span class="p">)):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Time </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">: Prey </span><span class="si">{</span><span class="n">prey</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2"> → </span><span class="si">{</span><span class="n">scaled_prey</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2"> → </span><span class="si">{</span><span class="n">formatted_prey</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, &quot;</span>
          <span class="sa">f</span><span class="s2">&quot;Predator </span><span class="si">{</span><span class="n">predator</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2"> → </span><span class="si">{</span><span class="n">scaled_predator</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2"> → </span><span class="si">{</span><span class="n">formatted_predator</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

Scaling factor: 1.261083
Original prey: 0.949917, 0.740551, 0.682246, 0.716674, 0.824511, 1.004565, 1.262928, 1.605509, 2.031105, 2.522882
Scaled prey: 1.197925, 0.933897, 0.860368, 0.903786, 1.039777, 1.266840, 1.592657, 2.024680, 2.561392, 3.181563
Formatted prey: 1.20, 0.93, 0.86, 0.90, 1.04, 1.27, 1.59, 2.02, 2.56, 3.18
Original predator: 1.040624, 0.779542, 0.564390, 0.407644, 0.300283, 0.229832, 0.186162, 0.162235, 0.154365, 0.161886
Scaled predator: 1.312313, 0.983067, 0.711743, 0.514073, 0.378682, 0.289837, 0.234766, 0.204592, 0.194667, 0.204152
Formatted predator: 1.31, 0.98, 0.71, 0.51, 0.38, 0.29, 0.23, 0.20, 0.19, 0.20

Scaling factor: 1.261083

Original vs. Scaled &amp; Formatted:
Time 0: Prey 0.949917 → 1.197925 → 1.20, Predator 1.040624 → 1.312313 → 1.31
Time 1: Prey 0.740551 → 0.933897 → 0.93, Predator 0.779542 → 0.983067 → 0.98
Time 2: Prey 0.682246 → 0.860368 → 0.86, Predator 0.564390 → 0.711743 → 0.71
Time 3: Prey 0.716674 → 0.903786 → 0.90, Predator 0.407644 → 0.514073 → 0.51
Time 4: Prey 0.824511 → 1.039777 → 1.04, Predator 0.300283 → 0.378682 → 0.38
Time 5: Prey 1.004565 → 1.266840 → 1.27, Predator 0.229832 → 0.289837 → 0.29
Time 6: Prey 1.262928 → 1.592657 → 1.59, Predator 0.186162 → 0.234766 → 0.23
Time 7: Prey 1.605509 → 2.024680 → 2.02, Predator 0.162235 → 0.204592 → 0.20
Time 8: Prey 2.031105 → 2.561392 → 2.56, Predator 0.154365 → 0.194667 → 0.19
Time 9: Prey 2.522882 → 3.181563 → 3.18, Predator 0.161886 → 0.204152 → 0.20
</pre></div></div>
</div>
</section>
<section id="LLMTIME-String-Representation">
<h3>LLMTIME String Representation<a class="headerlink" href="#LLMTIME-String-Representation" title="Link to this heading"></a></h3>
<p>Now we’ll format the scaled values into the LLMTIME format:</p>
<ul class="simple">
<li><p>Using commas (<code class="docutils literal notranslate"><span class="pre">,</span></code>) between prey and predator values</p></li>
<li><p>Using semicolons (<code class="docutils literal notranslate"><span class="pre">;</span></code>) between time steps</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Format according to LLMTIME scheme</span>
<span class="n">llmtime_string</span> <span class="o">=</span> <span class="s1">&#39;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
    <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">p</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">,</span><span class="si">{</span><span class="n">q</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">q</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">formatted_prey</span><span class="p">,</span> <span class="n">formatted_predator</span><span class="p">)]</span>
<span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;;&#39;</span>  <span class="c1"># Adding final semicolon</span>

<span class="c1"># Display formatted string</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;LLMTIME formatted string:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">llmtime_string</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
LLMTIME formatted string:
1.20,1.31;0.93,0.98;0.86,0.71;0.90,0.51;1.04,0.38;1.27,0.29;1.59,0.23;2.02,0.20;2.56,0.19;3.18,0.20;
</pre></div></div>
</div>
</section>
<section id="Tokenization-with-Qwen2.5-Tokenizer">
<h3>Tokenization with Qwen2.5 Tokenizer<a class="headerlink" href="#Tokenization-with-Qwen2.5-Tokenizer" title="Link to this heading"></a></h3>
<p>Next, we’ll tokenize this formatted string using the Qwen2.5-0.5B-Instruct tokenizer. Unlike some other models that might need special handling, Qwen’s tokenizer already effectively handles numeric values and punctuation tokens, as demonstrated below:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load Qwen tokenizer</span>
<span class="n">model_name</span> <span class="o">=</span> <span class="s2">&quot;Qwen/Qwen2.5-0.5B-Instruct&quot;</span>
<span class="n">tokenizer</span> <span class="o">=</span> <span class="n">AutoTokenizer</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="n">model_name</span><span class="p">,</span> <span class="n">trust_remote_code</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Tokenize formatted string</span>
<span class="n">encoded</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="p">(</span><span class="n">llmtime_string</span><span class="p">,</span> <span class="n">return_tensors</span><span class="o">=</span><span class="s1">&#39;pt&#39;</span><span class="p">)</span>
<span class="n">token_ids</span> <span class="o">=</span> <span class="n">encoded</span><span class="p">[</span><span class="s1">&#39;input_ids&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

<span class="c1"># Display tokenization</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Original string: </span><span class="si">{</span><span class="n">llmtime_string</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Tokenized IDs: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span><span class="w"> </span><span class="n">token_ids</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Display token → text mapping for a sample</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">First 20 tokens mapped to their text:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">token_id</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">token_ids</span><span class="p">[:</span><span class="mi">20</span><span class="p">]):</span>
    <span class="n">token_text</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">decode</span><span class="p">([</span><span class="n">token_id</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Token </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">: ID </span><span class="si">{</span><span class="n">token_id</span><span class="si">}</span><span class="s2"> → &#39;</span><span class="si">{</span><span class="n">token_text</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Original string: 1.20,1.31;0.93,0.98;0.86,0.71;0.90,0.51;1.04,0.38;1.27,0.29;1.59,0.23;2.02,0.20;2.56,0.19;3.18,0.20;

Tokenized IDs: 16, 13, 17, 15, 11, 16, 13, 18, 16, 26, 15, 13, 24, 18, 11, 15, 13, 24, 23, 26, 15, 13, 23, 21, 11, 15, 13, 22, 16, 26, 15, 13, 24, 15, 11, 15, 13, 20, 16, 26, 16, 13, 15, 19, 11, 15, 13, 18, 23, 26, 16, 13, 17, 22, 11, 15, 13, 17, 24, 26, 16, 13, 20, 24, 11, 15, 13, 17, 18, 26, 17, 13, 15, 17, 11, 15, 13, 17, 15, 26, 17, 13, 20, 21, 11, 15, 13, 16, 24, 26, 18, 13, 16, 23, 11, 15, 13, 17, 15, 26

First 20 tokens mapped to their text:
Token 0: ID 16 → &#39;1&#39;
Token 1: ID 13 → &#39;.&#39;
Token 2: ID 17 → &#39;2&#39;
Token 3: ID 15 → &#39;0&#39;
Token 4: ID 11 → &#39;,&#39;
Token 5: ID 16 → &#39;1&#39;
Token 6: ID 13 → &#39;.&#39;
Token 7: ID 18 → &#39;3&#39;
Token 8: ID 16 → &#39;1&#39;
Token 9: ID 26 → &#39;;&#39;
Token 10: ID 15 → &#39;0&#39;
Token 11: ID 13 → &#39;.&#39;
Token 12: ID 24 → &#39;9&#39;
Token 13: ID 18 → &#39;3&#39;
Token 14: ID 11 → &#39;,&#39;
Token 15: ID 15 → &#39;0&#39;
Token 16: ID 13 → &#39;.&#39;
Token 17: ID 24 → &#39;9&#39;
Token 18: ID 23 → &#39;8&#39;
Token 19: ID 26 → &#39;;&#39;
</pre></div></div>
</div>
</section>
</section>
<section id="Complete-Preprocessing-Pipeline-with-NumericalProcessor">
<h2>Complete Preprocessing Pipeline with NumericalProcessor<a class="headerlink" href="#Complete-Preprocessing-Pipeline-with-NumericalProcessor" title="Link to this heading"></a></h2>
<p>We’ve implemented a <code class="docutils literal notranslate"><span class="pre">NumericalProcessor</span></code> class in <code class="docutils literal notranslate"><span class="pre">preprocessor.py</span></code> that encapsulates all the steps above. Let’s use it to process our sample data and evaluate how well it preserves information:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__name__</span><span class="p">),</span> <span class="s1">&#39;..&#39;</span><span class="p">,</span> <span class="s1">&#39;src&#39;</span><span class="p">))</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">preprocessor</span><span class="w"> </span><span class="kn">import</span> <span class="n">NumericalProcessor</span>

<span class="c1"># Initialize processor with the tokenizer and full dataset (for scaling calculation)</span>
<span class="n">processor</span> <span class="o">=</span> <span class="n">NumericalProcessor</span><span class="p">(</span><span class="n">tokenizer</span><span class="p">,</span> <span class="n">trajectories</span><span class="p">)</span>

<span class="c1"># Process a sample of predator-prey data</span>
<span class="n">sample_prey</span><span class="p">,</span> <span class="n">sample_predator</span> <span class="o">=</span> <span class="n">prey</span><span class="p">[:</span><span class="mi">10</span><span class="p">],</span> <span class="n">predator</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
<span class="n">tokenized</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">preprocess</span><span class="p">(</span><span class="n">sample_prey</span><span class="p">,</span> <span class="n">sample_predator</span><span class="p">)</span>

<span class="c1"># Display string representation and token IDs</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;PREPROCESSING RESULTS:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
<span class="n">formatted_str</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">_to_string</span><span class="p">(</span><span class="n">sample_prey</span><span class="p">,</span> <span class="n">sample_predator</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;String representation:</span><span class="se">\n</span><span class="si">{</span><span class="n">formatted_str</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Token IDs (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">tokenized</span><span class="p">[</span><span class="s1">&#39;input_ids&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">())</span><span class="si">}</span><span class="s2"> tokens):</span><span class="se">\n</span><span class="si">{</span><span class="n">tokenized</span><span class="p">[</span><span class="s1">&#39;input_ids&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
============================================================
PREPROCESSING RESULTS:
------------------------------------------------------------
String representation:
1.20,1.31;0.93,0.98;0.86,0.71;0.90,0.51;1.04,0.38;1.27,0.29;1.59,0.23;2.02,0.20;2.56,0.19;3.18,0.20;
------------------------------------------------------------
Token IDs (100 tokens):
[16, 13, 17, 15, 11, 16, 13, 18, 16, 26, 15, 13, 24, 18, 11, 15, 13, 24, 23, 26, 15, 13, 23, 21, 11, 15, 13, 22, 16, 26, 15, 13, 24, 15, 11, 15, 13, 20, 16, 26, 16, 13, 15, 19, 11, 15, 13, 18, 23, 26, 16, 13, 17, 22, 11, 15, 13, 17, 24, 26, 16, 13, 20, 24, 11, 15, 13, 17, 18, 26, 17, 13, 15, 17, 11, 15, 13, 17, 15, 26, 17, 13, 20, 21, 11, 15, 13, 16, 24, 26, 18, 13, 16, 23, 11, 15, 13, 17, 15, 26]
============================================================
</pre></div></div>
</div>
</section>
<section id="Round-Trip-Testing:-Tokenize-→-Detokenize">
<h2>Round-Trip Testing: Tokenize → Detokenize<a class="headerlink" href="#Round-Trip-Testing:-Tokenize-→-Detokenize" title="Link to this heading"></a></h2>
<p>Now let’s test the full round trip - tokenize the data and then detokenize it back to numerical values. This will show how much information is preserved through the process:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Round-trip test: tokenize → detokenize</span>
<span class="n">token_ids</span> <span class="o">=</span> <span class="n">tokenized</span><span class="p">[</span><span class="s1">&#39;input_ids&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

<span class="c1"># Get the recovered data from tokens</span>
<span class="n">recovered_data</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">postprocess</span><span class="p">(</span><span class="n">token_ids</span><span class="p">)</span>

<span class="c1"># Get processed data (scaled and formatted) for comparison</span>
<span class="n">processed_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">formatted_prey</span><span class="p">,</span> <span class="n">formatted_predator</span><span class="p">))</span>

<span class="c1"># print(f&quot;Recovered string representation:\n{preprocessed_str}&quot;)</span>

<span class="c1"># Compare original, processed, and recovered data side by side</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ROUND-TRIP TEST (Original → Processed → Recovered):&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Prey values:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">orig</span><span class="p">,</span> <span class="n">proc</span><span class="p">,</span> <span class="n">rec</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">sample_prey</span><span class="p">,</span> <span class="n">processed_data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">recovered_data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Time </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">: Original: </span><span class="si">{</span><span class="n">orig</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2"> → Processed: </span><span class="si">{</span><span class="n">proc</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> → Recovered: </span><span class="si">{</span><span class="n">rec</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2"> (Diff: </span><span class="si">{</span><span class="n">rec</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">orig</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Predator values:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">orig</span><span class="p">,</span> <span class="n">proc</span><span class="p">,</span> <span class="n">rec</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">sample_predator</span><span class="p">,</span> <span class="n">processed_data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">recovered_data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Time </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">: Original: </span><span class="si">{</span><span class="n">orig</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2"> → Processed: </span><span class="si">{</span><span class="n">proc</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> → Recovered: </span><span class="si">{</span><span class="n">rec</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2"> (Diff: </span><span class="si">{</span><span class="n">rec</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">orig</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>

<span class="c1"># Calculate error metrics</span>
<span class="n">diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">recovered_data</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">sample_prey</span><span class="p">,</span> <span class="n">sample_predator</span><span class="p">)))</span>
<span class="n">mae</span> <span class="o">=</span> <span class="n">diff</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">max_error</span> <span class="o">=</span> <span class="n">diff</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<span class="n">rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">diff</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Error metrics:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mean Absolute Error: </span><span class="si">{</span><span class="n">mae</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Root Mean Square Error: </span><span class="si">{</span><span class="n">rmse</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Maximum Absolute Error: </span><span class="si">{</span><span class="n">max_error</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
============================================================
ROUND-TRIP TEST (Original → Processed → Recovered):
------------------------------------------------------------
Prey values:
Time 0: Original: 0.949917 → Processed: 1.20 → Recovered: 0.951563 (Diff: 0.001646)
Time 1: Original: 0.740551 → Processed: 0.93 → Recovered: 0.737461 (Diff: -0.003090)
Time 2: Original: 0.682246 → Processed: 0.86 → Recovered: 0.681954 (Diff: -0.000292)
Time 3: Original: 0.716674 → Processed: 0.90 → Recovered: 0.713672 (Diff: -0.003002)
Time 4: Original: 0.824511 → Processed: 1.04 → Recovered: 0.824688 (Diff: 0.000177)
Time 5: Original: 1.004565 → Processed: 1.27 → Recovered: 1.007071 (Diff: 0.002506)
Time 6: Original: 1.262928 → Processed: 1.59 → Recovered: 1.260821 (Diff: -0.002107)
Time 7: Original: 1.605509 → Processed: 2.02 → Recovered: 1.601798 (Diff: -0.003711)
Time 8: Original: 2.031105 → Processed: 2.56 → Recovered: 2.030001 (Diff: -0.001104)
Time 9: Original: 2.522882 → Processed: 3.18 → Recovered: 2.521642 (Diff: -0.001240)

Predator values:
Time 0: Original: 1.040624 → Processed: 1.31 → Recovered: 1.038790 (Diff: -0.001834)
Time 1: Original: 0.779542 → Processed: 0.98 → Recovered: 0.777110 (Diff: -0.002432)
Time 2: Original: 0.564390 → Processed: 0.71 → Recovered: 0.563008 (Diff: -0.001382)
Time 3: Original: 0.407644 → Processed: 0.51 → Recovered: 0.404414 (Diff: -0.003230)
Time 4: Original: 0.300283 → Processed: 0.38 → Recovered: 0.301328 (Diff: 0.001045)
Time 5: Original: 0.229832 → Processed: 0.29 → Recovered: 0.229961 (Diff: 0.000129)
Time 6: Original: 0.186162 → Processed: 0.23 → Recovered: 0.182383 (Diff: -0.003779)
Time 7: Original: 0.162235 → Processed: 0.20 → Recovered: 0.158594 (Diff: -0.003642)
Time 8: Original: 0.154365 → Processed: 0.19 → Recovered: 0.150664 (Diff: -0.003700)
Time 9: Original: 0.161886 → Processed: 0.20 → Recovered: 0.158594 (Diff: -0.003292)

Error metrics:
Mean Absolute Error: 0.002167
Root Mean Square Error: 0.002484
Maximum Absolute Error: 0.003779
============================================================
</pre></div></div>
</div>
</section>
<section id="Conclusion">
<h2>Conclusion<a class="headerlink" href="#Conclusion" title="Link to this heading"></a></h2>
<p>The preprocessing pipeline effectively converts the Lotka-Volterra predator-prey time series data into a format suitable for the Qwen2.5-0.5B-Instruct model. Key points:</p>
<ol class="arabic simple">
<li><p><strong>Scaling</strong>: We scale values to a reasonable range (0-10) using a scaling factor based on the 99.7 percentile</p></li>
<li><p><strong>Precision</strong>: We use 2 decimal places for numeric representation</p></li>
<li><p><strong>LLMTIME Format</strong>: We use commas to separate variables and semicolons to separate timesteps</p></li>
<li><p><strong>Information Preservation</strong>: The process maintains high fidelity with minimal information loss</p></li>
</ol>
<p>The low MAE between original and recovered values demonstrates that even with scaling and rounding, the tokenization process preserves the essential dynamics of the predator-prey system, allowing the language model to effectively learn and predict these patterns.</p>
<p>This preprocessing approach creates a bridge between numerical time series data and the language model’s token-based processing, enabling us to leverage Qwen2.5-0.5B-Instruct for predator-prey dynamics forecasting.</p>
</section>
<section id="Appendix:-Additional-Samples">
<h2>Appendix: Additional Samples<a class="headerlink" href="#Appendix:-Additional-Samples" title="Link to this heading"></a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># showcase two additional samples (preprocessed, and tokenized) to show how the processor works</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]:</span>
    <span class="n">prey_sample</span> <span class="o">=</span> <span class="n">trajectories</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">predator_sample</span> <span class="o">=</span> <span class="n">trajectories</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

    <span class="c1"># Preprocess the sample</span>
    <span class="n">tokenized_sample</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">preprocess</span><span class="p">(</span><span class="n">prey_sample</span><span class="p">,</span> <span class="n">predator_sample</span><span class="p">)</span>

    <span class="c1"># Display string representation and token IDs</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SAMPLE </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> PREPROCESSING RESULTS:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
    <span class="c1"># print raw data</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Raw prey data:     </span><span class="si">{</span><span class="n">prey_sample</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Raw predator data: </span><span class="si">{</span><span class="n">predator_sample</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Token IDs (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">tokenized_sample</span><span class="p">[</span><span class="s1">&#39;input_ids&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">())</span><span class="si">}</span><span class="s2"> tokens):</span><span class="se">\n</span><span class="si">{</span><span class="n">tokenized_sample</span><span class="p">[</span><span class="s1">&#39;input_ids&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
============================================================
SAMPLE 1 PREPROCESSING RESULTS:
------------------------------------------------------------
Raw prey data:     [0.9714744 1.0787003 1.260828  1.5218158 1.8605354]
Raw predator data: [1.0054137  0.82180643 0.6863802  0.59312147 0.53635156]
------------------------------------------------------------
Token IDs (50 tokens):
[16, 13, 17, 18, 11, 16, 13, 17, 22, 26, 16, 13, 18, 21, 11, 16, 13, 15, 19, 26, 16, 13, 20, 24, 11, 15, 13, 23, 22, 26, 16, 13, 24, 17, 11, 15, 13, 22, 20, 26, 17, 13, 18, 20, 11, 15, 13, 21, 23, 26]
============================================================
SAMPLE 2 PREPROCESSING RESULTS:
------------------------------------------------------------
Raw prey data:     [1.0732226 0.8540631 0.7681343 0.7687197 0.8349962]
Raw predator data: [1.112855   0.9001321  0.70823574 0.55306584 0.434924  ]
------------------------------------------------------------
Token IDs (50 tokens):
[16, 13, 18, 20, 11, 16, 13, 19, 15, 26, 16, 13, 15, 23, 11, 16, 13, 16, 19, 26, 15, 13, 24, 22, 11, 15, 13, 23, 24, 26, 15, 13, 24, 22, 11, 15, 13, 22, 15, 26, 16, 13, 15, 20, 11, 15, 13, 20, 20, 26]
</pre></div></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../index.html" class="btn btn-neutral float-left" title="Time Series Forecasting with Qwen2.5-0.5B LLM" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="2_flops_calculation.html" class="btn btn-neutral float-right" title="Understanding FLOPS Calculation for Qwen2.5 Models" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Yuchen Mao.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>